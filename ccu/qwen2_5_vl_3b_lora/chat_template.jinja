{% set system_prompt = 'You are a helpful assistant.' %}{% if messages[0]['role'] == 'system' %}{% set system_prompt_content = messages[0]['content'] %}{% set messages = messages[1:] %}{% else %}{% set system_prompt_content = system_prompt %}{% endif %}{{ '<|begin_of_text|>' }}{% if system_prompt_content != '' %}{{ '<|start_header_id|>system<|end_header_id|>

' }}{% if system_prompt_content is string %}{{ system_prompt_content }}{% else %}{% for part in system_prompt_content %}{{ part }}{% endfor %}{% endif %}{{ '<|eot_id|>' }}{% endif %}{% for message in messages %}{{ '<|start_header_id|>' + message['role'] + '<|end_header_id|>

' }}{% if message['content'] is string %}{{ message['content'] }}{% else %}{% for part in message['content'] %}{{ part }}{% endfor %}{% endif %}{{ '<|eot_id|>' }}{% endfor %}{% if add_generation_prompt %}{{ '<|start_header_id|>assistant<|end_header_id|>

' }}{% endif %}